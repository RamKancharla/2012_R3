<?xml version = '1.0' encoding = 'UTF-8'?>
<?oracle-xsl-mapper <!-- SPECIFICATION OF MAP SOURCES AND TARGETS, DO NOT MODIFY. -->
  <mapSources>
    <source type="XSD">
      <schema location="EAI.MSG.SFDC.OP.248_PublishOpportunityEventRequest.xsd"/>
      <rootElement name="SFDCOpportunityEvent" namespace="http://www.reuters.com/ns/2007/09/01/GCAP/EAI/OpportunityManagement"/>
    </source>
  </mapSources>
  <mapTargets>
    <target type="XSD">
      <schema location="http://inkaban3ua-eai01:7777/orabpel/ccrmasync/CCRMOP_SubmitOpportunity/EAI.MSG.CCRM.OP.226_PublishOpportunityRequestResponse.xsd"/>
      <rootElement name="RCRMOpportunityPublish" namespace="http://www.siebel.com/xml/RCRM%20Opportunity%20Inbound"/>
    </target>
  </mapTargets>
  <!-- GENERATED BY ORACLE XSL MAPPER 10.1.3.3.0(build 070615.0525) AT [THU SEP 23 13:42:39 GMT+05:30 2010]. -->
?>
<xsl:stylesheet version="1.0" xmlns:gcap-message="http://www.reuters.com/ns/2007/09/01/GCAP/CommonMessageTypes" xmlns:bpws="http://schemas.xmlsoap.org/ws/2003/03/business-process/" xmlns:xsdLocal="http://www.reuters.com/ns/2007/09/01/GCAP/EAI/OpportunityManagement" xmlns:ehdr="http://www.oracle.com/XSL/Transform/java/oracle.tip.esb.server.headers.ESBHeaderFunctions" xmlns:gcap-opportunity="http://www.reuters.com/ns/2007/09/01/GCAP/CommonOpportunityTypes" xmlns:xsd="http://www.w3.org/2001/XMLSchema" xmlns:hwf="http://xmlns.oracle.com/bpel/workflow/xpath" xmlns:xp20="http://www.oracle.com/XSL/Transform/java/oracle.tip.pc.services.functions.Xpath20" xmlns:xref="http://www.oracle.com/XSL/Transform/java/oracle.tip.xref.xpath.XRefXPathFunctions" xmlns:xsl="http://www.w3.org/1999/XSL/Transform" xmlns:ns0="http://www.siebel.com/xml/RCRM%20Opportunity%20Inbound" xmlns:ora="http://schemas.oracle.com/xpath/extension" xmlns:ids="http://xmlns.oracle.com/bpel/services/IdentityService/xpath" xmlns:orcl="http://www.oracle.com/XSL/Transform/java/oracle.tip.pc.services.functions.ExtFunc" xmlns:gcap-sa="http://www.reuters.com/ns/2007/09/01/GCAP/SchemaAnnotations" xmlns:gcap-account="http://www.reuters.com/ns/2007/09/01/GCAP/CommonAccountTypes" exclude-result-prefixes="xsl gcap-message xsdLocal gcap-opportunity xsd gcap-sa gcap-account ns0 bpws ehdr hwf xp20 xref ora ids orcl" xmlns:dvm="http://www.oracle.com/XSL/Transform/java/oracle.tip.dvm.LookupValue">
  <xsl:param name="prmBillDate" select="/xsdLocal:SFDCOpportunityEvent/xsdLocal:opportunityHeader/xsdLocal:expectedRevenueDate"/>
  <xsl:param name="prmCloseDate" select="/xsdLocal:SFDCOpportunityEvent/xsdLocal:opportunityHeader/xsdLocal:closeDate"/>
  <xsl:template match="/">
    <ns0:RCRMOpportunityPublish>
      <ns0:UserId>
        <xsl:value-of select="/xsdLocal:SFDCOpportunityEvent/xsdLocal:eaiHeader/gcap-message:tracingId"/>
      </ns0:UserId>
      <ns0:Timestamp>
        <xsl:value-of select="/xsdLocal:SFDCOpportunityEvent/xsdLocal:eaiHeader/gcap-message:timeStamp"/>
      </ns0:Timestamp>
      <ns0:SourceSystem>
        <xsl:value-of select="/xsdLocal:SFDCOpportunityEvent/xsdLocal:eaiHeader/gcap-message:applicationId"/>
      </ns0:SourceSystem>
      <ns0:ActionCode>
        <xsl:value-of select="/xsdLocal:SFDCOpportunityEvent/xsdLocal:actionCode"/>
      </ns0:ActionCode>
      <ns0:Opportunity>
        <ns0:OptyNumber>
          <xsl:value-of select="/xsdLocal:SFDCOpportunityEvent/xsdLocal:opportunityHeader/xsdLocal:optyNumber"/>
        </ns0:OptyNumber>
        <ns0:ActiveQuote>
          <xsl:value-of select="/xsdLocal:SFDCOpportunityEvent/xsdLocal:opportunityHeader/xsdLocal:activeQuote"/>
        </ns0:ActiveQuote>
        <xsl:for-each select="/xsdLocal:SFDCOpportunityEvent/xsdLocal:opportunityHeader/xsdLocal:opportyTeam">
          <ns0:OpportunityPosition>
            <ns0:SFDCId>
              <xsl:value-of select="xsdLocal:SFDCOptyID"/>
            </ns0:SFDCId>
            <ns0:PrimaryRevenueCurrencyCode>
              <xsl:value-of select="../xsdLocal:currencyCode"/>
            </ns0:PrimaryRevenueCurrencyCode>
            <ns0:OpportunityId>
              <xsl:value-of select="xsdLocal:siebelOptyID"/>
            </ns0:OpportunityId>
            <ns0:EmailAddress>
              <xsl:value-of select="xsdLocal:employeeEmailAddress"/>
            </ns0:EmailAddress>
          </ns0:OpportunityPosition>
        </xsl:for-each>
        <ns0:Updated>
          <xsl:value-of select="/xsdLocal:SFDCOpportunityEvent/xsdLocal:opportunityHeader/xsdLocal:lastUpdated"/>
        </ns0:Updated>
        <xsl:for-each select="/xsdLocal:SFDCOpportunityEvent/xsdLocal:opportunityPrdct">
          <ns0:OpportunityProduct>
            <ns0:RCRMRevenueType>
              <xsl:value-of select="xsdLocal:revenueType"/>
            </ns0:RCRMRevenueType>
            <ns0:RCRMFreeTrialFlag>
              <xsl:value-of select="xsdLocal:freeTrialFlag"/>
            </ns0:RCRMFreeTrialFlag>
            <ns0:ProductQuantity>
              <xsl:value-of select="xsdLocal:quantity"/>
            </ns0:ProductQuantity>
            <xsl:choose>
              <xsl:when test="(xsdLocal:revenueType = &quot;Recurring&quot;) and (string-length(xsdLocal:monthlyReccuring) > 0.0)">
                <ns0:ProductPrice>
                  <xsl:value-of select="xsdLocal:monthlyReccuring"/>
                </ns0:ProductPrice>
              </xsl:when>
              <xsl:when test="(string-length(xsdLocal:oneTime) > 0.0) and (xsdLocal:revenueType = &quot;Once-Off&quot;)">
                <ns0:ProductPrice>
                  <xsl:value-of select="xsdLocal:oneTime"/>
                </ns0:ProductPrice>
              </xsl:when>
              <xsl:otherwise>
                <ns0:ProductPrice>
                  <xsl:value-of select="string(&quot;0&quot;)"/>
                </ns0:ProductPrice>
              </xsl:otherwise>
            </xsl:choose>
            <ns0:ProductId>
              <xsl:value-of select="generate-id()"/>
            </ns0:ProductId>
            <ns0:Product>
              <xsl:value-of select="xsdLocal:productFamily"/>
            </ns0:Product>
            <ns0:OpptyId>
              <xsl:value-of select="xsdLocal:siebelOptyID"/>
            </ns0:OpptyId>
            <xsl:choose>
              <xsl:when test="xsdLocal:freeTrialFlag = &quot;Y&quot;">
                <ns0:ExtendedPrice>
                  <xsl:value-of select="xsdLocal:oneTime"/>
                </ns0:ExtendedPrice>
              </xsl:when>
              <xsl:otherwise>
                <ns0:ExtendedPrice>
                  <xsl:value-of select="string(&quot;0&quot;)"/>
                </ns0:ExtendedPrice>
              </xsl:otherwise>
            </xsl:choose>
            <ns0:CurrencyCode>
              <xsl:value-of select="../xsdLocal:opportunityHeader/xsdLocal:currencyCode"/>
            </ns0:CurrencyCode>
            <ns0:Comment>
              <xsl:value-of select="xsdLocal:productComments"/>
            </ns0:Comment>
            <ns0:RCRMInstallAccId>
              <xsl:value-of select="xsdLocal:InstalledToId"/>
            </ns0:RCRMInstallAccId>
            <ns0:RCRMRevenueMasterflag>
              <xsl:value-of select="xsdLocal:revenueMasteringflag"/>
            </ns0:RCRMRevenueMasterflag>
          </ns0:OpportunityProduct>
        </xsl:for-each>
        <xsl:for-each select="/xsdLocal:SFDCOpportunityEvent/xsdLocal:opportunityHeader/xsdLocal:campaignSrcCode">
          <ns0:Campaign>
            <ns0:SourceCode>
              <xsl:value-of select="xsdLocal:sourceCode"/>
            </ns0:SourceCode>
          </ns0:Campaign>
        </xsl:for-each>
        <ns0:OpportunityNotes>
          <ns0:Note2>
            <xsl:value-of select="substring(/xsdLocal:SFDCOpportunityEvent/xsdLocal:opportunityHeader/xsdLocal:opportunityDescription,16001.0,string-length(/xsdLocal:SFDCOpportunityEvent/xsdLocal:opportunityHeader/xsdLocal:opportunityDescription))"/>
          </ns0:Note2>
          <ns0:Note1>
            <xsl:value-of select="substring(/xsdLocal:SFDCOpportunityEvent/xsdLocal:opportunityHeader/xsdLocal:opportunityDescription,1.0,16000.0)"/>
          </ns0:Note1>
        </ns0:OpportunityNotes>
        <ns0:ReasonWonLost>
          <xsl:value-of select="substring(/xsdLocal:SFDCOpportunityEvent/xsdLocal:opportunityHeader/xsdLocal:winLossReason,orcl:last-index-within-string(/xsdLocal:SFDCOpportunityEvent/xsdLocal:opportunityHeader/xsdLocal:winLossReason,&quot;;&quot;) + 2.0)"/>
        </ns0:ReasonWonLost>
        <ns0:RCRMSFDCOpptyId>
          <xsl:value-of select="/xsdLocal:SFDCOpportunityEvent/xsdLocal:opportunityHeader/xsdLocal:SFDCOptyID"/>
        </ns0:RCRMSFDCOpptyId>
        <ns0:RCRMSFDCAccountId>
          <xsl:value-of select="/xsdLocal:SFDCOpportunityEvent/xsdLocal:opportunityHeader/xsdLocal:SFDCAccountID"/>
        </ns0:RCRMSFDCAccountId>
        <ns0:RCRMOpportunityType>
          <xsl:value-of select="/xsdLocal:SFDCOpportunityEvent/xsdLocal:opportunityHeader/xsdLocal:optyType"/>
        </ns0:RCRMOpportunityType>
        <ns0:OnceOffRevenue>
          <xsl:value-of select="/xsdLocal:SFDCOpportunityEvent/xsdLocal:opportunityHeader/xsdLocal:OnceOffRevenue"/>
        </ns0:OnceOffRevenue>
        <ns0:RCRMFTSumTotalPriceRecurring>
          <xsl:value-of select="/xsdLocal:SFDCOpportunityEvent/xsdLocal:opportunityHeader/xsdLocal:expectedRevenue"/>
        </ns0:RCRMFTSumTotalPriceRecurring>
        <ns0:RCRMBillDate>
          <xsl:value-of select="xp20:format-dateTime($prmBillDate,&quot;[M01]/[D01]/[Y0001] [H01]:[m01]:[s01]&quot;)"/>
        </ns0:RCRMBillDate>
        <ns0:AccountMgrEmailAddress>
          <xsl:value-of select="/xsdLocal:SFDCOpportunityEvent/xsdLocal:opportunityHeader/xsdLocal:ownerEmail"/>
        </ns0:AccountMgrEmailAddress>
        <ns0:RecurringRevenue>
          <xsl:value-of select="/xsdLocal:SFDCOpportunityEvent/xsdLocal:opportunityHeader/xsdLocal:monthlyRecurring"/>
        </ns0:RecurringRevenue>
        <ns0:PositionCloseDate>
          <xsl:value-of select="xp20:format-dateTime($prmCloseDate,&quot;[M01]/[D01]/[Y0001] [H01]:[m01]:[s01]&quot;)"/>
        </ns0:PositionCloseDate>
        <ns0:LastUpdatedBy>
          <xsl:value-of select="/xsdLocal:SFDCOpportunityEvent/xsdLocal:opportunityHeader/xsdLocal:lastUpdatedBy"/>
        </ns0:LastUpdatedBy>
        <ns0:AccountId>
          <xsl:value-of select="/xsdLocal:SFDCOpportunityEvent/xsdLocal:opportunityHeader/xsdLocal:siebelAccountID"/>
        </ns0:AccountId>
        <ns0:Id>
          <xsl:value-of select="/xsdLocal:SFDCOpportunityEvent/xsdLocal:opportunityHeader/xsdLocal:siebelOptyID"/>
        </ns0:Id>
        <ns0:CurrencyCode>
          <xsl:value-of select="/xsdLocal:SFDCOpportunityEvent/xsdLocal:opportunityHeader/xsdLocal:currencyCode"/>
        </ns0:CurrencyCode>
        <ns0:Name>
          <xsl:value-of select="/xsdLocal:SFDCOpportunityEvent/xsdLocal:opportunityHeader/xsdLocal:optyname"/>
        </ns0:Name>
        <ns0:RCRMUtahBlockedOpportunity>
          <xsl:value-of select="/xsdLocal:SFDCOpportunityEvent/xsdLocal:opportunityHeader/xsdLocal:blockedOpportunities"/>
        </ns0:RCRMUtahBlockedOpportunity>
        <ns0:PrimaryRevenueWinProbability>
          <xsl:value-of select="/xsdLocal:SFDCOpportunityEvent/xsdLocal:opportunityHeader/xsdLocal:probability"/>
        </ns0:PrimaryRevenueWinProbability>
        <ns0:SalesStage>
          <xsl:value-of select="/xsdLocal:SFDCOpportunityEvent/xsdLocal:opportunityHeader/xsdLocal:salesStage"/>
        </ns0:SalesStage>
        <ns0:RCRMPurchaseOrder>
          <xsl:value-of select="/xsdLocal:SFDCOpportunityEvent/xsdLocal:opportunityHeader/xsdLocal:PurchaseOrderNumber"/>
        </ns0:RCRMPurchaseOrder>
        <ns0:RCRMPurchaseOrderStatus>
          <xsl:value-of select="/xsdLocal:SFDCOpportunityEvent/xsdLocal:opportunityHeader/xsdLocal:IsPoRequired"/>
        </ns0:RCRMPurchaseOrderStatus>
      </ns0:Opportunity>
    </ns0:RCRMOpportunityPublish>
  </xsl:template>
</xsl:stylesheet>
